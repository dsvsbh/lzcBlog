---
title: mysql列的联合索引什么时候生效
date: 2025-01-14 19:00:21
tags: mysql
categories: 八股文
---

**联合索引（Composite Index）** 是指在数据库中为多个列创建的索引，它可以提高查询性能，尤其是在涉及多个列的条件查询时。然而，联合索引的生效与使用条件有关。以下是几个常见的情况，说明联合索引何时生效：

### **1. 查询条件中涉及索引的前缀列**

联合索引生效的关键在于查询中是否使用了索引的前缀列（即联合索引中左侧的列）。联合索引按列顺序存储数据，因此，只有当查询条件涉及到联合索引的前缀部分时，索引才能生效。

例如，假设有以下联合索引：

sql

复制代码

`CREATE INDEX idx_name ON table_name (col1, col2, col3);`

在此例中，`(col1, col2, col3)` 是联合索引。

#### **生效情况：**

- **使用前缀列：** 只要查询条件中包含索引的**前缀部分**，索引都会生效。
  - 例如，查询 `col1` 或 `col1, col2`，联合索引都会生效。
  - 查询条件 `col1 = ?` 或 `col1 = ? AND col2 = ?`，索引会生效。
  - 查询条件 `col1 = ? AND col2 = ? AND col3 = ?`，索引会生效。

#### **不生效情况：**

- **缺少前缀列：** 如果查询条件中没有涉及联合索引的前缀列，则联合索引不会生效。
  
  - 例如，查询 `col2 = ?` 或 `col3 = ?`，联合索引就不会生效，虽然索引中的后续列（`col2` 和 `col3`）参与了查询。
  
  - **注意：** 只有索引中的前缀列 `col1` 能影响查询是否命中联合索引。

### **2. 查询顺序是否匹配索引顺序**

联合索引的列顺序对索引的使用至关重要。查询中的列顺序必须与联合索引中定义的列顺序匹配或前缀列匹配，才能充分利用联合索引。

例如，假设有联合索引 `(col1, col2)`，而查询中使用的是 `col2, col1` 顺序：

sql

复制代码

`SELECT * FROM table_name WHERE col2 = ? AND col1 = ?;`

此查询不会使用索引，因为索引中的列顺序是 `(col1, col2)`，而查询的顺序是 `(col2, col1)`，它不符合索引顺序。

### **3. 使用 LIKE、BETWEEN、IN 等查询操作**

联合索引在处理 **`LIKE`**、**`BETWEEN`** 和 **`IN`** 等条件时也会生效，但具体情况取决于操作的使用。

- **LIKE 查询：**
  
  - 如果 `LIKE` 查询的模式以固定字符开头，索引通常会生效。
  - 例如：`WHERE col1 LIKE 'abc%'` 会利用 `(col1, col2)` 索引。
  - 如果 `LIKE` 查询以 `%` 开头，索引一般不会生效，因为无法通过前缀匹配。

- **BETWEEN 查询：**
  
  - `BETWEEN` 查询通常能使用联合索引，前提是查询的列符合索引前缀。
  
  例如，`WHERE col1 BETWEEN 1 AND 10 AND col2 = ?` 会利用 `(col1, col2)` 索引。

- **IN 查询：**
  
  - `IN` 操作符能利用联合索引，只要它的列顺序符合联合索引中的顺序。
  
  例如，`WHERE col1 IN (1, 2, 3) AND col2 = ?` 会利用 `(col1, col2)` 索引。

### **4. 使用范围查询**

- 当查询条件中有范围操作（如 `>`, `<`, `BETWEEN`, `!=`），联合索引通常能在范围查询列之前部分生效，但范围查询后面的列可能会失效。
  
  例如，`WHERE col1 = ? AND col2 > ?` 会使用 `(col1, col2)` 索引，但 `col2` 的范围查询后，索引可能不再生效。

### **5. 全表扫描 vs. 索引扫描**

- 如果联合索引的列没有有效地匹配查询条件，数据库优化器可能会选择放弃使用索引，转而执行全表扫描，尤其是在索引选择性不高的情况下。

### **总结**

联合索引生效的条件主要有：

1. 查询条件中涉及联合索引的前缀列（即索引中的左侧列）。
2. 查询条件的列顺序与联合索引的列顺序一致。
3. 使用范围查询时，索引可能只在前缀列生效。
4. LIKE、IN、BETWEEN 等操作符可以在特定情况下利用联合索引，但要满足顺序和前缀的条件。

因此，在设计和使用联合索引时，最好按照查询的实际需求来调整索引的列顺序和使用方式。
