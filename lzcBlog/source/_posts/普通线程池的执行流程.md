---
title: 普通线程池的执行流程
date: 2024-11-01 16:50:09
tags: java基础
categories: 八股文
---

普通线程池的执行流程通常包括以下几个步骤：

1. **线程池初始化**  
   在线程池创建时，预先设置好线程池的参数（如核心线程数、最大线程数、任务队列等），并初始化一组核心线程。线程池会根据参数控制线程的创建和销毁，以实现对资源的合理管理。

2. **提交任务**  
   当有任务提交到线程池时，线程池会根据当前的线程数和任务队列的状态来判断如何处理该任务。

3. **任务执行流程**  
   根据线程池的状态和配置，线程池采取以下策略来执行任务：
   
   - **核心线程数未满**：如果当前运行的线程数量少于核心线程数，则线程池会立即创建一个新的线程来执行任务。
   - **核心线程已满，任务队列未满**：如果核心线程数已满，任务会被放入任务队列中，等待空闲线程执行。
   - **任务队列已满，且线程数未达上限**：如果任务队列已满，且线程池中线程数少于最大线程数，线程池会创建一个新的线程来执行任务。
   - **任务队列已满，且线程数达到上限**：如果任务队列和线程池的线程数都已达到上限，线程池根据拒绝策略（如抛出异常、丢弃任务等）来处理新任务。

4. **线程执行任务**  
   被分配到任务的线程开始执行任务代码。当任务执行完毕后，线程会检查任务队列中是否还有等待执行的任务，如果有，则继续从队列中获取任务并执行。

5. **线程回收与销毁**
   
   - **空闲线程回收**：如果一个线程在指定的空闲时间内没有接收到新任务，且线程池的线程数超过了核心线程数，那么线程池会将该线程回收，释放资源。
   - **线程池关闭**：当调用线程池的 `shutdown` 方法后，线程池会停止接收新任务，并等待所有已提交的任务执行完毕。可以使用 `shutdownNow` 方法立即中断所有线程，强制关闭线程池。

6. **任务结束后的清理**  
   当所有任务执行完毕，线程池会根据配置的回收策略，关闭空闲的线程并清理资源，确保系统资源不会被长期占用。

整个流程使得线程池能够高效地复用线程资源，并在高并发场景下避免频繁的线程创建和销毁，有效地控制系统的资源占用和性能表现。
