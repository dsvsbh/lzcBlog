---
title: 实在智能实习经历收获
date: 2024-10-26 18:32:16
tags: 实习
categories: 实习业务
---

> 2024年9月18日入职杭州实在智能有限公司java实习生

## 实习历程：

- 刚入职被要求去杭州烟草部署IDP项目，接触到了k8s流水线打包，集群一键部署，了解到了IDP的私有化应用场景，对IDP项目产品有了初步认识，更加熟练的掌握了linux，docker，k8s的一些命令

- 杭州烟草完成部署后，开始熟悉IDP4.4.0代码，写自定义抽取模板的标注任务相关接口，学习到了很多代码编写规范，枚举，stream流，git，分布式锁等的使用场景，通过阅读复杂的大项目代码，让我的阅读代码能力有了显著的提升，对代码结构和表结构都更加了解

- 接口开发完后与前端联调接口，让我学习到了怎么快速去发现问题，定位问题，debug调试，最后修复异常解决问题，联调过程中提高了与同事沟通交流的能力

- 设计自定义抽取模板的节点数据结构和处理器，这部分让我学会了如何根据prd设计复杂的数据结构，也让我接触到了工厂模式和注册表模式的实际应用场景，对spring有了更深的理解，通过接算法用到了远程调用

- 设计crm合同审核调用接口，通过sql去生成模板和配置模板，通过python代码配置内置规则，与算法对接抽取模板，在接口方法中用到了工厂加注册表模式，提高程序扩展性，可维护性，设计异步任务执行的回调接口，通过redis缓存任务邮箱，最后和任务结果比对，异步返回

- 完成ocr任务对接，联调抽取自定义的任务执行，通过连接k8s集群通过日志跟踪状态，修复bug

- 完成自定义抽取模板任务执行的bug修复开发，使用线程池，completableFuture，mq等工具优化任务的异步执行，实现并发提速，线程复用减小开销，控制线程资源防止资源耗尽，通过异步解耦防止主线程阻塞，提高响应速度和任务执行效率。通过synchronized同步节点结果合并防止并发合并导致结果出错,通过数据库的版本号优化用户结果修改反馈，防止多个用户操作统一资源导致线程安全问题

- 完成crm接口的开发，联调，测试，上线

## 实习项目介绍（实习经历）

**项目介绍：**

IDP文档审阅系统是一个集成多种文档处理功能的平台，涵盖抽取模板、审核模板、文本比对，OCR识别等模板，支持用户自定义模板配置。该系统大幅降低了文档处理的人工成本，用户通过上传文件便可完成多种文档审阅任务，项目支持线上使用和私有化部署，线上地址：[http://idp.ai-indeed.com/](http://idp.ai-indeed.com/)。

**负责模块**:主要负责IDP4.4.0自定义抽取模板，IDP4.3.0CRM平台合同审核接口开发、测试、联调以及一些私有化定制部署

**主要工作：** 

- **自定义抽取模板开发**：采用工厂模式+注册表模式优化自定义抽取模板节点数据结构和处理器的设计，使自定义抽取流程灵活可扩展。集成OpenFeign远程调用OCR算法，实现表格抽取功能，通过Hystrix做熔断降级策略，当高并发请求而算法服务不可用时通过熔断降级防止资源的浪费并提升5秒以上响应速度。
- **自定义抽取任务管理**：开发了NLP抽取节点标注任务(用于模型训练)，通过Redis实现简易分布式锁，避免nlp节点标注父任务重复创建，确保幂等性。通过mq,线程池,completableFuture等工具优化自定义抽取任务的异步执行，异步解耦提升响应速度和任务执行效率。 通过悲观锁和乐观锁分别优化节点结果合并，多个用户操作同一结果，防止多线程抢夺同一资源出现并发问题。
- **OCR集成与CRM审核模板生成**：编写SQL脚本创建OCR抽取模板，并为其配置字段审核规则。调用阿里云数脉API验证合同中公司信息的合法性，生成符合CRM平台审核需求的模板，确保OCR数据的准确性及业务信息的合规性。
- **CRM异步任务处理和结果反馈**：  为CRM平台开发接口，采用工厂模式根据文件类型动态获取审核模板，异步执行任务，并将任务标识与用户邮箱存入Redis以追踪任务状态。任务完成后，通过回调接口核对Redis中的邮箱信息与任务结果的准确性，利用RocketMQ异步推送结果至CRM平台，确保任务反馈的实时性和系统处理的高效稳定。
- **私有化定制部署**：参与系统的私有化部署，基于K8s流水线完成一键打包部署，通过SQL或Shell脚本设定租户授权期限，为客户提供定制化IDP系统。成功完成了杭州烟草、中数通等客户的私有化部署和授权配置，满足了多客户的个性化需求。

## 实习期间遇到的难点：

- 项目难点1：由于平台请求要携带邮箱与任务执行结果中的邮箱做比对，而任务执行是异步无法同步返回结果做比对，而且任务执行无法将对应邮箱带进去做审核
  解决方案：异步执行任务时同步返回一个taskCode，将taskCode和邮箱作为k,v存入redis，当任务异步执行完毕，拿到任务结果和redis中任务对应的邮箱做比对审核

- 项目难点2:由于任务是异步执行的，而业务需要获取到任务结果异步返回给平台
  首先想的是任务执行完成后将结果入库，用定时任务去扫描数据库得到任务结果返回，这样的话会浪费线程资源，解决方案是设计一个回调接口，当任务异步执行完后请求回调接口，拿到任务执行结果去redis拿邮箱比对然后mq异步返回结果给平台
